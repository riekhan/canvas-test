<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8"/>
    <title>Canvas tutorial</title>
    <style type="text/css">
        canvas { border: 1px solid black; }
    </style>
    <script type="text/javascript">

      gamestate = { 
        origin: {x: 375, y: 400},
        rotation: 0,
        input: {
          KeyW: {pressed: false, timestamp: null},
          KeyA: {pressed: false, timestamp: null},
          KeyS: {pressed: false, timestamp: null},
          KeyD: {pressed: false, timestamp: null},
          KeyQ: {pressed: false, timestamp: null},
          KeyE: {pressed: false, timestamp: null},
        }
      };

      function keydown(event){
        if (gamestate.input[event.code]){
          let key = gamestate.input[event.code];
          key.pressed = true;
          key.timestamp = event.timeStamp;
        }
      }

      function keyup(event){
        if (gamestate.input[event.code]){
          let key = gamestate.input[event.code];
          key.pressed = false;
          key.timestamp = event.timeStamp;
        }
      }

      window.addEventListener('keydown', keydown);
      window.addEventListener('keyup', keyup);

      function drawShape(ctx, ship, origin, rotation){
        let points = ship.points;
        let center = ship.center;

        ctx.clearRect(0,0,1000,1000);
        ctx.save();
        ctx.beginPath();
        ctx.translate(origin.x+center.x, origin.y+center.y);
        ctx.rotate(rotation * Math.PI/180);
        ctx.translate(-center.x, -center.y);
        let curPos = {x:0, y:0};
        for(let p of points){
          let nextPos = {x: curPos.x + p.x, y: curPos.y + p.y}
          ctx.lineTo(nextPos.x, nextPos.y);
          curPos = nextPos;
        }
        ctx.fillStyle = '#4D4E53';
        ctx.fill();
        ctx.restore();
      }

      function getShip(){
        return { center: {x:0, y:50},
                 points: [{x:-30, y:100},
                          {x:27, y:0},
                          {x:0, y:-20},
                          {x:6, y:0},
                          {x:0, y:20},
                          {x:27,y:0},
                          {x:-30,y:-100}]
                };
      }

      function update(){
        if(gamestate.input.KeyW.pressed){
          gamestate.origin.y -= 10;
          gamestate.input.KeyW.pressed = false;
        }
        if(gamestate.input.KeyS.pressed){
          gamestate.origin.y += 10;
          gamestate.input.KeyS.pressed = false;
        }
        if(gamestate.input.KeyA.pressed){
          gamestate.origin.x -= 10;
          gamestate.input.KeyA.pressed = false;
        }
        if(gamestate.input.KeyD.pressed){
          gamestate.origin.x += 10;
          gamestate.input.KeyD.pressed = false;
        }
        if(gamestate.input.KeyQ.pressed){
          gamestate.rotation -= 10;
          gamestate.input.KeyQ.pressed = false;
        }
        if(gamestate.input.KeyE.pressed){
          gamestate.rotation += 10;
          gamestate.input.KeyE.pressed = false;
        }
      }



      function game() {
        let canvas = document.getElementById('game');
        let ctx = canvas.getContext('2d');
        let ship = getShip();
        update()
        drawShape(ctx,ship,gamestate.origin,gamestate.rotation);
        requestAnimationFrame(game)
      }

    </script>
  </head>
  <body onload="game();">
    <canvas id="game" width="1000" height="1000"></canvas>
  </body>
</html>